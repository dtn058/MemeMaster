<!doctype html>
<html>

<head>
    <script src="https://www.gstatic.com/firebasejs/5.5.9/firebase.js"></script>
    <script>
        // initialize firebase
    var config = {
        apiKey: "AIzaSyAdhmE_VvXS83MvrZYtRmLLVvQDRJw4k2E",
        authDomain: "cse134bprojmememaster.firebaseapp.com",
        databaseURL: "https://cse134bprojmememaster.firebaseio.com",
        projectId: "cse134bprojmememaster",
        storageBucket: "cse134bprojmememaster.appspot.com",
        messagingSenderId: "108809510486"
    };
    firebase.initializeApp(config);
    </script>
    <script src="memeGenerationJS.js"></script>
    <script src="memeStorage.js"></script>
    <style>
    body{ background-color: ivory; }
    canvas{border:1px solid red;}
    #wrapTemplates{
    height: 100px;
    overflow: scroll;
    overflow-y: hidden;
    white-space: nowrap;
    
}
#wrapTemplates .im{
    display: inline-block;
}

.im > .templateMeme {
    width: 50px;
    height: 50px;
    border-right: 3px solid #fff;
    cursor: pointer
}
</style>

<body>

    <!-- dont need? <img src="blob:http://localhost:5000/ed201892-3946-42ad-a1bf-2a9ab62ea403"> -->

    <!-- begin grabbing info for the meme creation-->
    Title of meme: <input type="text" id="titleText"><br>
    Top text:<textarea id="topText"></textarea> <input id="topTextSizeInput" type='range' min ="0.05" max="0.25" value="0.05" step="0.01"><br>
    Bottom text:<textarea id="botText"></textarea> <input id="botTextSizeInput" type='range' min ="0.05" max="0.25" value="0.05" step="0.01"'><br> 
    <!-- sliders to adjust font size -->
    Upload a file: <input id="upload" type="file" accept="image/*">
    <!-- upload an image for a template -->
    <h2> Or select from one of our templates </h1>
    <!-- previews of our template memes-->
    <div id="wrapTemplates">
        <div class ="im">
            <img id='pikaMeme' class = "templateMeme" >
        </div>
        <div class ="im">
            <img id= "safeMeme" class = "templateMeme">
        </div>
        <div class ="im">
            <img id= "distractedBoyMeme" class = "templateMeme" >
        </div>
        <div class ="im">
            <img id= "FWPMeme" class = "templateMeme">
        </div>
        <div class ="im">
            <img id= "AliensMeme" class = "templateMeme" >
        </div>
        <div class ="im">
            <img id= "BatmanRobinMeme" class = "templateMeme" >
        </div>
        <div class ="im">
            <img id= "BlackGirlWatMeme" class = "templateMeme" >
        </div>
        <div class ="im">
            <img id= "BlueButtonMeme" class = "templateMeme" >
        </div>
        <div class ="im">
            <img id= "NotMyBusinessMeme" class = "templateMeme">
        </div>
        <div class ="im">
            <img id= "bubblesGirlMeme" class = "templateMeme" >
        </div>
        <div class ="im">
            <img id= "conspiracyKeanuMeme" class = "templateMeme" >
        </div>
        <div class ="im">
            <img id= "creepyWonkaMeme" class = "templateMeme" >
        </div>
        <div class ="im">
            <img id= "dogeMeme" class = "templateMeme" >
        </div>
        <div class ="im">
            <img id= "futuramaMeme" class = "templateMeme" >
        </div>
        <div class ="im">
            <img id= "grumpyCatMeme" class = "templateMeme" >
        </div>
        <div class ="im">
            <img id= "pillsMeme" class = "templateMeme" >
        </div>
        <div class ="im">
            <img id= "johnnyMeme" class = "templateMeme" >
        </div>
        <div class ="im">
            <img id= "haroldMeme" class = "templateMeme" >
        </div>
        <div class ="im">
            <img id= "asianDadMeme" class = "templateMeme" >
        </div>
        <div class ="im">
            <img id= "liveDangerouslyMeme" class = "templateMeme" >
        </div>
        <div class ="im">
            <img id= "interestingManMeme" class = "templateMeme" >
        </div>
        <div class ="im">
            <img id= "pigeonMeme" class = "templateMeme" >
        </div>
        <div class ="im">
            <img id= "jackieChanMeme" class = "templateMeme" >
        </div>
        <div class ="im">
            <img id= "leoDicaprioMeme" class = "templateMeme" >
        </div>
        <div class ="im">
            <img id= "offRampMeme" class = "templateMeme" >
        </div>
        <div class ="im">
            <img id= "notSimplyMeme" class = "templateMeme" >
        </div>
        <div class ="im">
            <img id= "oprahMeme" class = "templateMeme" >
        </div>
        <div class ="im">
            <img id= "philosoraptorMeme" class = "templateMeme" >
        </div>
        <div class ="im">
            <img id= "successKidMeme" class = "templateMeme" >
        </div>
        <div class ="im">
            <img id= "twoButtonsMeme" class = "templateMeme" >
        </div>
        <div class ="im">
            <img id= "teacherMeme" class = "templateMeme" >
        </div>
        <div class ="im">
            <img id= "xAllYMeme" class = "templateMeme" >
        </div>

    </div>
    <input id="theText" type="text">
    Upload a Meme Template via URL: <input id='urlUp' , type='text'> <button id='upBut' , type='button' , onclick='replaceUrl()'>Upload</button>
    <!-- upload template via url -->
    <button id='downloadMeme' , type='button, onclick=downloadImage()'>Download Your Meme! </button>
    <button id="saveMeme">Save Meme!</button>
    <!-- save the meme into realtime database-->
    <div>
    <button id="shareBtnModal">Share!</button>
    <!-- The Modal -->
    <div id="shareModal" class="modal">
        <!-- Modal content -->
        <div class="modal-content">
            <span class="close">&times;</span>
            <input type="text" name="downloadLink" id="downloadLinkID" value="download link"><br><br>
            <button id="gmailShareBtn">share with google!</button>
        </div>
    </div>
    </div>
    <hr>
    <canvas id="canvas" />
    <img id="test"/>

<script>
const fileInput = document.getElementById('upload');
var selectedFile = fileInput.files[0];

// allows the download of the meme
var link = document.createElement('a');
link.id = 'link';
link.addEventListener('click', function(ev) {
    link.href = canvas.toDataURL('image/png');
    //console.log(link.href);
    link.download = document.getElementById('titleText').value;
}, false);
document.body.appendChild(link);

var but = document.getElementById('downloadMeme');
document.getElementById('link').appendChild(but)

/*if(selectedFile != null){
   console.log('selectedFileExists....');
  var test = selectedFile.imageURL;
  document.getElementById("test").src = test;

}
else{
    console.log('selectedFile is null....');
}*/



fileInput.addEventListener('change', (e) => doSomethingWithFiles(e.target.files));

/*fileInput.addEventListener('change', sendPic, false);*/

var output = document.getElementById('test');

function doSomethingWithFiles(fileList) {
    file = null;

    for (let i = 0; i < fileList.length; i++) {
        if (fileList[i].type.match(/^image\//)) {
            file = fileList[i];
            break;
        }
    }

    if (file !== null) {
        isFileNull = false;
        output.src = URL.createObjectURL(file);

        document.getElementById("test").src = output.src;




        console.log("FILE URL IS: " + output.src);
        /* var ref = firebase.storage().ref('/memeTemplates');
         var childRef = ref.child(output.src);
         childRef.put(file).then(function(snapshot){
           console.log('uploaded a file!');
         });*/

    }
}




function alertSuccessfulFileUpload() {
    alert("successfully uploaded image!");
}

function checkIfFileIsNull() {
    if (file == null) {
        isFileNull = true;
        alert("No image selected: please select an image to upload!");
    } else {
        // uploadFile();

    }

}
</script>


    
</body>

</head>
</html>